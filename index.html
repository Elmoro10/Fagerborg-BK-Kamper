<!doctype html>
<html lang="no">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Terminliste – Fagerborg BK (2026)</title>

  <style>
    :root{
      /* Match tabell-repoet */
      --bg:#f3f4f6;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#6b7280;
      --line:#e5e7eb;
      --head:#f8fafc;

      --radius:14px;
      --shadow: 0 10px 30px rgba(15, 23, 42, .08);

      --our-bg: rgba(22,163,74,.12);
      --our-text: #16a34a;

      /* Chips */
      --chip:#f3f4f6;
      --chipText:#374151;
      --chipOkBg: rgba(22,163,74,.12);
      --chipOkText: #16a34a;
      --chipBadBg: rgba(220,38,38,.12);
      --chipBadText: #dc2626;

      /* Tabs */
      --tabBg: #f3f4f6;
      --tabBorder: #e5e7eb;
      --tabActive: #ffffff;

      /* Match list layout */
      --datew: 150px;
      --scorew: 70px;

      /* Front */
      --frontLogo: 76px;
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      background:var(--bg);
      color:var(--text);
    }

    .wrap{
      max-width:1200px;
      margin:0 auto;
      padding:12px 10px;
    }

    .grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:10px;
    }
    @media(max-width: 920px){
      .grid{ grid-template-columns:1fr; }
    }
    .grid.single{ grid-template-columns: 1fr; }

    .card{
      background:var(--card);
      border:1px solid var(--line);
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      overflow:hidden;
      min-width:0;
    }

    /* Header (brukes ikke i front) */
    .card-head{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:10px 12px;
      border-bottom:1px solid var(--line);
      background:var(--head);
    }
    .card-title{
      font-weight:900;
      font-size:18px;
      letter-spacing:-.01em;
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
    }
    .team-mark{
      width:10px;
      height:22px;
      border-radius:999px;
      background: var(--our-text);
      box-shadow: inset 0 0 0 1px rgba(15,23,42,.06);
      flex:0 0 auto;
    }
    .badge{
      font-size:12px;
      color:var(--muted);
      border:1px solid var(--line);
      background:#fff;
      padding:6px 10px;
      border-radius:999px;
      white-space:nowrap;
    }

    /* Tabs (ikke i front) */
    .tabs{ padding:10px 12px 0; }
    .tab-wrap{
      display:flex;
      gap:6px;
      background:var(--tabBg);
      border:1px solid var(--tabBorder);
      padding:5px;
      border-radius:999px;
    }
    .tab{
      flex:1 1 auto;
      border:1px solid transparent;
      background: transparent;
      color: var(--muted);
      font-weight:900;
      font-size:12px;
      padding:8px 10px;
      border-radius:999px;
      cursor:pointer;
      white-space:nowrap;
    }
    .tab[aria-selected="true"]{
      background: var(--tabActive);
      border-color: var(--line);
      color: var(--text);
    }

    /* Match list */
    .list{
      padding:10px 12px 12px;
      display:flex;
      flex-direction:column;
      gap:8px;
    }

    .match{
      position:relative;
      display:grid;
      grid-template-columns: var(--datew) 1fr var(--scorew);
      gap:10px;
      align-items:center;
      padding:10px 10px;
      border:1px solid var(--line);
      border-radius:12px;
      background:#fff;
      min-width:0;
    }

    @media (max-width: 520px){
      :root{ --datew: 1fr; --scorew: 1fr; }
      .match{ grid-template-columns: 1fr; gap:8px; }
    }

    .match.our{
      background: var(--our-bg);
      border-color: rgba(22,163,74,.18);
    }
    .match.our::before{
      content:"";
      position:absolute;
      left:0; top:0; bottom:0;
      width:4px;
      background: var(--our-text);
    }

    .when{ display:flex; flex-direction:column; gap:4px; min-width:0; }
    .dt{
      font-weight:900;
      font-size:13px;
      letter-spacing:-.01em;
      color: var(--text);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .venue{
      font-size:12px;
      color: var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .versus{ display:flex; align-items:center; gap:10px; min-width:0; }
    .team{ display:flex; align-items:center; gap:8px; min-width:0; flex: 1 1 0; }
    .team.right{ justify-content:flex-end; }
    .name{
      font-weight:900;
      font-size:13px;
      letter-spacing:-.01em;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      color: var(--text);
    }
    .vs{
      font-weight:900;
      font-size:12px;
      color: var(--muted);
      letter-spacing:.04em;
      flex:0 0 auto;
    }

    .logo{
      width:22px; height:22px;
      border-radius:999px;
      border:1px solid var(--line);
      background:#fff;
      object-fit:contain;
      flex:0 0 auto;
    }
    .logo.fallback{
      background:#e5e7eb;
      border:1px solid #d1d5db;
    }

    .rightbox{ display:flex; flex-direction:column; align-items:flex-end; gap:6px; }
    @media (max-width: 520px){ .rightbox{ align-items:flex-start; } }

    .score{
      font-weight:900;
      font-size:14px;
      letter-spacing:-.01em;
      color: var(--text);
      white-space:nowrap;
    }

    .chip{
      display:inline-flex;
      align-items:center;
      padding:5px 9px;
      border-radius:999px;
      font-size:11px;
      font-weight:900;
      background: var(--chip);
      color: var(--chipText);
      border:1px solid var(--line);
      white-space:nowrap;
    }
    .chip.ok{
      background: var(--chipOkBg);
      color: var(--chipOkText);
      border-color: rgba(22,163,74,.18);
    }
    .chip.bad{
      background: var(--chipBadBg);
      color: var(--chipBadText);
      border-color: rgba(220,38,38,.18);
    }

    .loading,.error{
      padding:12px;
      margin:10px;
      border-radius:12px;
      font-size:14px;
      background:#fff;
    }
    .loading{
      color:var(--muted);
      border:1px dashed #d1d5db;
    }
    .error{
      background:#fee2e2;
      border:1px solid #fecaca;
      color:#991b1b;
      white-space:pre-wrap;
    }
    .empty{
      padding:12px;
      border-radius:12px;
      border:1px dashed #d1d5db;
      background:#fff;
      color:var(--muted);
      font-size:14px;
    }

    /* ============================================================
       FRONT (view=front) – kun stor "Neste kamp" (A-laget)
       Arsenal-ish: dato/tid venstre, turnering/sted høyre
       ============================================================ */
    body.front .wrap{ max-width: 680px; }
    body.front .grid{ grid-template-columns: 1fr !important; }
    body.front .card{ overflow: hidden; }

    .front-pad{
      padding:12px;
    }

    .fixture{
      border:1px solid var(--line);
      border-radius:14px;
      background:#fff;
      overflow:hidden;
    }

    /* "Neste kamp" overskrift */
    .fixture-top{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:12px 12px 10px;
      border-bottom:1px solid var(--line);
      background:#fff;
    }
    .fixture-top h2{
      margin:0;
      font-size:22px;
      font-weight:1000;
      letter-spacing:-.02em;
    }
    .fixture-pill{
      font-size:12px;
      color:var(--muted);
      border:1px solid var(--line);
      background:#fff;
      padding:6px 10px;
      border-radius:999px;
      white-space:nowrap;
      font-weight:900;
    }

    /* Meta-linje som Arsenal: venstre/høyre */
    .fixture-meta{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:12px;
      padding:12px;
      border-bottom:1px solid var(--line);
      background:#fff;
    }

    .meta-left .day{
      font-weight:1000;
      letter-spacing:.06em;
      font-size:13px;
      color:var(--muted);
      text-transform:uppercase;
      margin-bottom:4px;
    }
    .meta-left .date{
      font-weight:1000;
      font-size:18px;
      letter-spacing:-.02em;
      line-height:1.1;
    }

    .meta-right{
      text-align:right;
      min-width: 40%;
    }
    .meta-right .comp{
      font-weight:1000;
      font-size:13px;
      color:var(--muted);
      text-transform:uppercase;
      letter-spacing:.06em;
      margin-bottom:4px;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .meta-right .place{
      font-weight:1000;
      font-size:14px;
      letter-spacing:-.01em;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    /* Kickoff-linje */
    .fixture-kick{
      padding:0 12px 12px;
      color:var(--muted);
      font-size:12px;
      border-bottom:1px solid var(--line);
      background:#fff;
    }
    .fixture-kick b{
      color:var(--text);
      font-weight:1000;
      letter-spacing:.06em;
    }

    /* Logo/teams */
    .fixture-teams{
      padding:16px 12px 10px;
      display:grid;
      grid-template-columns: 1fr 60px 1fr;
      gap:10px;
      align-items:center;
      background:#fff;
    }
    .ft{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:10px;
      min-width:0;
    }
    .biglogo{
      width:var(--frontLogo);
      height:var(--frontLogo);
      border-radius:999px;
      border:1px solid var(--line);
      background:#fff;
      object-fit:contain;
    }
    .biglogo.fallback{
      background:#e5e7eb;
      border:1px solid #d1d5db;
    }
    .ft .tname{
      font-weight:1000;
      letter-spacing:-.02em;
      text-align:center;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width:100%;
      font-size:16px;
    }
    .vmark{
      text-align:center;
      font-weight:1000;
      font-size:26px;
      color:var(--muted);
      letter-spacing:.06em;
    }

    /* CTA knapp nederst (kun denne) */
    .fixture-actions{
      padding:12px;
      background:#fff;
      display:flex;
      justify-content:center;
    }
    .fixture-btn{
      width:100%;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding:14px 16px;
      border-radius:999px;
      border:1px solid var(--line);
      background:#fff;
      color:var(--text);
      font-weight:1000;
      cursor:pointer;
      text-decoration:none;
      letter-spacing:-.01em;
      font-size:16px;
    }
    .fixture-btn:hover{ filter: brightness(.98); }

    @media (max-width: 420px){
      :root{ --frontLogo: 66px; }
      .fixture-teams{ grid-template-columns: 1fr 46px 1fr; }
      .vmark{ font-size:24px; }
      .fixture-top h2{ font-size:20px; }
      .meta-left .date{ font-size:17px; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <section class="grid" id="grid"></section>
  </div>

  <script>
    function esc(s){
      return String(s ?? "").replace(/[&<>"']/g, m => ({
        '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
      }[m]));
    }

    function repoBaseUrl(){
      const p = location.pathname;
      const root = p.endsWith("/") ? p : p.substring(0, p.lastIndexOf("/") + 1);
      return location.origin + root;
    }

    function normalizeUrl(u){
      const s = String(u || "").trim();
      if (!s) return "";
      if (s.startsWith("//")) return "https:" + s;
      if (s.startsWith("http://")) return "https://" + s.slice("http://".length);
      return s;
    }

    function toAbsMaybe(u){
      const s = normalizeUrl(u);
      if (!s) return "";
      if (s.startsWith("http://") || s.startsWith("https://")) return s;
      return repoBaseUrl() + s.replace(/^\//, "");
    }

    function parseKickoffMs(m){
      const t = Date.parse(m.kickoff);
      return Number.isFinite(t) ? t : NaN;
    }

    function isFinished(m){
      return String(m.status || "").toUpperCase() === "FINISHED" ||
        (Number.isFinite(m.homeGoals) && Number.isFinite(m.awayGoals));
    }

    function scoreText(m){
      if (Number.isFinite(m.homeGoals) && Number.isFinite(m.awayGoals)) return `${m.homeGoals}\u2013${m.awayGoals}`;
      return "–";
    }

    function statusChip(m){
      const s = String(m.status || "").toUpperCase();
      if (s === "CANCELLED") return { text:"Avlyst", cls:"chip bad" };
      if (isFinished(m)) return { text:"Spilt", cls:"chip ok" };
      return { text:"Kommende", cls:"chip" };
    }

    function isFagerborgMatch(teamObj, m){
      const tn = String(teamObj?.teamName || "Fagerborg").toLowerCase();
      const home = String(m.homeTeam || "").toLowerCase();
      const away = String(m.awayTeam || "").toLowerCase();
      return home.includes(tn) || away.includes(tn);
    }

    function safeUrl(u){
      try{
        if (!u) return "";
        return new URL(u, location.href).href;
      }catch{
        return "";
      }
    }

    function logoNode(url, cls){
      const abs = toAbsMaybe(url);
      if (!abs){
        const sp = document.createElement("span");
        sp.className = cls + " fallback";
        return sp;
      }
      const img = document.createElement("img");
      img.className = cls;
      img.loading = "lazy";
      img.alt = "";
      img.src = abs;

      /* Hjelper ofte hvis host blokkerer referrer/hotlink */
      img.referrerPolicy = "no-referrer";

      img.onerror = () => {
        const sp = document.createElement("span");
        sp.className = cls + " fallback";
        img.replaceWith(sp);
      };
      return img;
    }

    function fmtListNo(dtIso){
      try{
        const d = new Date(dtIso);
        return d.toLocaleString('nb-NO', {
          weekday:'short',
          year:'numeric',
          month:'2-digit',
          day:'2-digit',
          hour:'2-digit',
          minute:'2-digit'
        }).replace(',', '');
      }catch{
        return "Ukjent tid";
      }
    }

    function matchRow(teamObj, m){
      const row = document.createElement("div");
      row.className = "match" + (isFagerborgMatch(teamObj, m) ? " our" : "");

      const when = document.createElement("div");
      when.className = "when";

      const dt = document.createElement("div");
      dt.className = "dt";
      dt.textContent = fmtListNo(m.kickoff);

      const venue = document.createElement("div");
      venue.className = "venue";
      venue.textContent = String(m.venue || "");
      venue.title = String(m.venue || "");

      when.append(dt, venue);

      const versus = document.createElement("div");
      versus.className = "versus";

      const home = document.createElement("div");
      home.className = "team";
      home.append(
        logoNode(m.homeLogoUrl, "logo"),
        Object.assign(document.createElement("div"), { className:"name", title:String(m.homeTeam||""), textContent:String(m.homeTeam||"Ukjent") })
      );

      const vs = document.createElement("div");
      vs.className = "vs";
      vs.textContent = "VS";

      const away = document.createElement("div");
      away.className = "team right";
      away.append(
        Object.assign(document.createElement("div"), { className:"name", title:String(m.awayTeam||""), textContent:String(m.awayTeam||"Ukjent") }),
        logoNode(m.awayLogoUrl, "logo")
      );

      versus.append(home, vs, away);

      const right = document.createElement("div");
      right.className = "rightbox";

      const sc = document.createElement("div");
      sc.className = "score";
      sc.textContent = scoreText(m);

      const chip = statusChip(m);
      const ch = document.createElement("div");
      ch.className = chip.cls;
      ch.textContent = chip.text;

      right.append(sc, ch);

      row.append(when, versus, right);

      const u = safeUrl(m.matchUrl);
      if (u){
        row.style.cursor = "pointer";
        row.title = "Åpne kamp på fotball.no";
        row.addEventListener("click", () => {
          if (window.getSelection && String(window.getSelection()).length > 0) return;
          window.open(u, "_blank", "noopener");
        });
      }

      return row;
    }

    function filterMatches(teamObj, mode){
      const ms = Array.isArray(teamObj?.matches) ? teamObj.matches.slice() : [];
      const now = Date.now();

      const getT = (m) => {
        const t = parseKickoffMs(m);
        return Number.isFinite(t) ? t : (mode === "played" ? -Infinity : Infinity);
      };

      const isFbk = (m) => isFagerborgMatch(teamObj, m);

      if (mode === "upcoming"){
        const x = ms.filter(m => {
          const t = parseKickoffMs(m);
          if (!Number.isFinite(t)) return false;
          if (!isFbk(m)) return false;
          return t >= now && String(m.status || "").toUpperCase() !== "CANCELLED";
        });
        x.sort((a,b) => getT(a) - getT(b));
        return x;
      }

      if (mode === "played"){
        const x = ms.filter(m => {
          const t = parseKickoffMs(m);
          if (!Number.isFinite(t)) return false;
          if (!isFbk(m)) return false;
          return t < now;
        });
        x.sort((a,b) => getT(b) - getT(a));
        return x;
      }

      ms.sort((a,b) => getT(a) - getT(b));
      return ms;
    }

    function makeCard(teamKey, teamObj){
      const title = teamKey === "a" ? "A-Laget" : "B-Laget";
      const badgeText = String(teamObj?.tournament || "2026");

      const card = document.createElement("div");
      card.className = "card";

      const head = document.createElement("div");
      head.className = "card-head";

      const left = document.createElement("div");
      left.className = "card-title";
      left.append(Object.assign(document.createElement("span"), { className:"team-mark" }));
      left.append(Object.assign(document.createElement("span"), { textContent: title }));

      const badge = document.createElement("div");
      badge.className = "badge";
      badge.textContent = badgeText;

      head.append(left, badge);
      card.appendChild(head);

      const tabs = document.createElement("div");
      tabs.className = "tabs";
      const wrap = document.createElement("div");
      wrap.className = "tab-wrap";
      wrap.setAttribute("role", "tablist");

      const btnUpcoming = document.createElement("button");
      btnUpcoming.className = "tab";
      btnUpcoming.setAttribute("role","tab");
      btnUpcoming.setAttribute("aria-selected","true");
      btnUpcoming.type = "button";
      btnUpcoming.textContent = "Kommende";

      const btnPlayed = document.createElement("button");
      btnPlayed.className = "tab";
      btnPlayed.setAttribute("role","tab");
      btnPlayed.setAttribute("aria-selected","false");
      btnPlayed.type = "button";
      btnPlayed.textContent = "Siste spilte";

      const btnAll = document.createElement("button");
      btnAll.className = "tab";
      btnAll.setAttribute("role","tab");
      btnAll.setAttribute("aria-selected","false");
      btnAll.type = "button";
      btnAll.textContent = "Alle lag";

      wrap.append(btnUpcoming, btnPlayed, btnAll);
      tabs.appendChild(wrap);
      card.appendChild(tabs);

      const list = document.createElement("div");
      list.className = "list";
      card.appendChild(list);

      const state = { mode: "upcoming" };

      function setSelected(mode){
        state.mode = mode;
        btnUpcoming.setAttribute("aria-selected", mode === "upcoming" ? "true" : "false");
        btnPlayed.setAttribute("aria-selected", mode === "played" ? "true" : "false");
        btnAll.setAttribute("aria-selected", mode === "all" ? "true" : "false");
        renderList();
      }

      function renderList(){
        list.innerHTML = "";
        const ms = filterMatches(teamObj, state.mode);
        if (!ms.length){
          const d = document.createElement("div");
          d.className = "empty";
          d.textContent =
            state.mode === "upcoming" ? "Ingen kommende Fagerborg-kamper funnet."
            : state.mode === "played" ? "Ingen spilte Fagerborg-kamper funnet."
            : "Ingen kamper funnet.";
          list.appendChild(d);
          return;
        }
        ms.forEach(m => list.appendChild(matchRow(teamObj, m)));
      }

      btnUpcoming.addEventListener("click", () => setSelected("upcoming"));
      btnPlayed.addEventListener("click", () => setSelected("played"));
      btnAll.addEventListener("click", () => setSelected("all"));

      renderList();
      return card;
    }

    function formatFrontMeta(m, fallbackTournament){
      const d = new Date(m.kickoff);
      const day = d.toLocaleDateString('nb-NO', { weekday:'short' }).replace('.', '').toUpperCase();
      const date = d.toLocaleDateString('nb-NO', { day:'2-digit', month:'2-digit', year:'numeric' });
      const time = d.toLocaleTimeString('nb-NO', { hour:'2-digit', minute:'2-digit' });

      const tournament = String(m.tournament || fallbackTournament || "").trim();
      const venue = String(m.venue || "").trim();

      return { day, date, time, tournament, venue };
    }

    function makeFrontAOnly(teamObj){
      const card = document.createElement("div");
      card.className = "card";

      const pad = document.createElement("div");
      pad.className = "front-pad";

      const fixture = document.createElement("div");
      fixture.className = "fixture";

      // Title row
      const top = document.createElement("div");
      top.className = "fixture-top";
      const h2 = document.createElement("h2");
      h2.textContent = "Neste kamp";
      const pill = document.createElement("div");
      pill.className = "fixture-pill";
      pill.textContent = "Kommende";
      top.append(h2, pill);
      fixture.appendChild(top);

      // Find next A-match (kun Fagerborg)
      const ms = Array.isArray(teamObj?.matches) ? teamObj.matches.slice() : [];
      const now = Date.now();
      const fbk = ms
        .map(m => ({ m, t: parseKickoffMs(m) }))
        .filter(x => Number.isFinite(x.t))
        .filter(x => isFagerborgMatch(teamObj, x.m))
        .filter(x => String(x.m.status || "").toUpperCase() !== "CANCELLED");

      const next = fbk
        .filter(x => x.t >= now)
        .sort((a,b) => a.t - b.t)[0]?.m || null;

      if (!next){
        const wrap = document.createElement("div");
        wrap.style.padding = "12px";
        const emp = document.createElement("div");
        emp.className = "empty";
        emp.textContent = "Ingen kamp funnet.";
        wrap.appendChild(emp);
        fixture.appendChild(wrap);
      } else {
        const { day, date, time, tournament, venue } = formatFrontMeta(next, teamObj?.tournament || "2026");

        const meta = document.createElement("div");
        meta.className = "fixture-meta";

        const left = document.createElement("div");
        left.className = "meta-left";
        left.innerHTML = `
          <div class="day">${esc(day)}</div>
          <div class="date">${esc(date)}</div>
        `;

        const right = document.createElement("div");
        right.className = "meta-right";
        right.innerHTML = `
          <div class="comp">${esc(tournament || " ")}</div>
          <div class="place">${esc(venue || " ")}</div>
        `;

        meta.append(left, right);
        fixture.appendChild(meta);

        const kick = document.createElement("div");
        kick.className = "fixture-kick";
        kick.innerHTML = `<b>KICKOFF</b> – ${esc(time)}`;
        fixture.appendChild(kick);

        const teams = document.createElement("div");
        teams.className = "fixture-teams";

        const home = document.createElement("div");
        home.className = "ft";
        home.append(
          logoNode(next.homeLogoUrl, "biglogo"),
          Object.assign(document.createElement("div"), { className:"tname", title:String(next.homeTeam||""), textContent:String(next.homeTeam||"Ukjent") })
        );

        const v = document.createElement("div");
        v.className = "vmark";
        v.textContent = "V";

        const away = document.createElement("div");
        away.className = "ft";
        away.append(
          logoNode(next.awayLogoUrl, "biglogo"),
          Object.assign(document.createElement("div"), { className:"tname", title:String(next.awayTeam||""), textContent:String(next.awayTeam||"Ukjent") })
        );

        teams.append(home, v, away);
        fixture.appendChild(teams);
      }

      // Only button at bottom -> external terminliste
      const actions = document.createElement("div");
      actions.className = "fixture-actions";
      const btn = document.createElement("a");
      btn.className = "fixture-btn";
      btn.href = "https://www.fagerborgbk.no/next/p/10973/terminlister";
      btn.target = "_top";
      btn.rel = "noopener";
      btn.textContent = "Se alle kamper";
      actions.appendChild(btn);
      fixture.appendChild(actions);

      pad.appendChild(fixture);
      card.appendChild(pad);
      return card;
    }

    function applyMode(){
      const params = new URLSearchParams(location.search);
      const view = (params.get("view") || "").toLowerCase();

      if (view === "front"){
        document.body.classList.add("front");
        return { view:"front", team:"a" }; // låst til A i front
      }
      document.body.classList.remove("front");

      const team = (params.get("team") || "both").toLowerCase(); // a|b|both
      return { view:"", team };
    }

    function renderLoading(grid, mode){
      grid.innerHTML = "";
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `<div class="loading">Laster…</div>`;
      grid.appendChild(card);
    }

    function renderError(grid, msg){
      grid.innerHTML = "";
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `<div class="error">${esc(msg || "Kunne ikke hente data.")}</div>`;
      grid.appendChild(card);
    }

    function renderData(grid, mode, data){
      grid.innerHTML = "";

      const aObj = data?.a || null;
      const bObj = data?.b || null;

      if (mode.view === "front"){
        grid.className = "grid single";
        grid.appendChild(makeFrontAOnly(aObj));
        return;
      }

      // Normal view
      grid.className = "grid" + ((mode.team === "a" || mode.team === "b") ? " single" : "");

      if (mode.team === "a"){
        grid.appendChild(makeCard("a", aObj));
      } else if (mode.team === "b"){
        grid.appendChild(makeCard("b", bObj));
      } else {
        grid.appendChild(makeCard("a", aObj));
        grid.appendChild(makeCard("b", bObj));
      }
    }

    async function loadAndRender(){
      const grid = document.getElementById("grid");
      const mode = applyMode();
      renderLoading(grid, mode);

      const url = repoBaseUrl() + "data/matches.json?ts=" + Date.now();

      try{
        const res = await fetch(url, { cache:"no-store" });
        if (!res.ok) throw new Error("HTTP " + res.status);
        const json = await res.json();

        if (!json || typeof json !== "object"){
          renderError(grid, "Dataformatet var uventet.");
          return;
        }

        renderData(grid, mode, json);
      }catch(e){
        renderError(grid, "Kunne ikke hente data.\n" + (e.message || String(e)));
      }
    }

    window.addEventListener("DOMContentLoaded", () => {
      loadAndRender();
      setInterval(loadAndRender, 60 * 1000);
    });
  </script>
</body>
</html>
